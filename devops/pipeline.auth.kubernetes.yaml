trigger:
  # - main
  - none
pool:
  name: Default
# variables:
#   - group: authGroup
  ##### following variables are defined in the variable group #####
  # appNameDev
  # appNameProd
  # azureSubscription
  # slotName
stages:
  ################################################## Build ##################################################
  - stage: Build
    displayName: "Build & Publish"
    jobs:
      - job: Publish
        steps:
          - task: DotNetCoreCLI@2
            displayName: "Publish Code"
            inputs:
              command: "publish"
              workingDirectory: "Auth"
              arguments: "--configuration Release --output $(Build.ArtifactStagingDirectory)"
              publishWebProjects: false
              zipAfterPublish: true
          - publish: "$(Build.ArtifactStagingDirectory)"
            displayName: "Publish Artifact"
            artifact: drop
          - task: Docker@2
            displayName: Build image (no push)
            inputs:
              command: build
              repository: AuthApi
              dockerfile: Auth/Dockerfile
              buildContext: .
              tags: |
                latest
          - task: Docker@2
            displayName: Push docker container to container registry
            inputs:
              command: push
              repository: AuthApi
              dockerfile: Auth/Dockerfile
              containerRegistry: $(DockerRegistryServiceConnection)
              buildContext: .
              tags: |
                latest
